# 基本服务操作

```bash
## 启动并后台运行
$ redis-server & nohup
## 查是否启动
$ redis-cli ping
## 关闭命令
$ redis-cli shutdown

```

# 基本Redis操作

```bash
## 命令行客户端启动
$ redis-cli
## 测试心跳
127.0.0.1:6379> ping
PONG
## 设置 mykey 键的值
127.0.0.1:6379> set mykey hello
OK
## 获取 mykey 键的值
127.0.0.1:6379> get mykey
"hello"
## 设置 mykey 失效事件
127.0.0.1:6379> expire mykey 2
```


## 开启通知

键空间事件通知默认被禁用，因为这个特性消耗CPU电量不是很明智。使用`redis.conf`的`notify-keyspace-events`，或者通过`CONFIG SET`来开启通知。 

```bash 
## 设置配置开启通知功能
$ redis-cli config set notify-keyspace-events KEA
## 命令行监控所有通知
$ redis-cli --csv psubscribe '__key*__:*'
Reading messages... (press Ctrl-C to quit)
"psubscribe","__key*__:*",1
```

## 键值说明

```
K     Keyspace events, published with __keyspace@<db>__ prefix.  
E     Keyevent events, published with __keyevent@<db>__ prefix.  
g     Generic commands (non-type specific) like DEL, EXPIRE, RENAME, ...  
$     String commands  
l     List commands  
s     Set commands  
h     Hash commands  
z     Sorted set commands  
x     Expired events (events generated every time a key expires)  
e     Evicted events (events generated when a key is evicted for maxmemory)  
A     Alias for g$lshzxe, so that the "AKE" string means all the events. 
```

## 不同命令产生的事件(Events generated by different commands) 

按照下面的清单，不同的命令产生不同类型的事件。 [Redis Keyspace Notifications](http://redis.io/topics/notifications)

- DEL 为每一个被删除的键产生一个del事件。
- RENAME 产生两个事件，为源键产生一个rename_from事件，为目标键产生一个rename_to事件。
- EXPIRE 当为键设置过期时产生一个expire事件，或者每当设置了过期的键被删除时产生一个expired事件(查看EXPIRE文档获取更多信息)。
- SORT 当STORE用于设置一个新键时产生一个sortstore事件。当结果列表为空，并且使用了STORE选项，并且已经有一个该名字的键存在，那么这个件键被删除，所以这种条件下或产生一个del事件。
- SET及其所有变种(SETEX, SETNX,GETSET) 产生set事件。但是SETEX还会产生一个expire事件。
- MSET 为每个键产生一个单独的set事件。
- SETRANGE 产生一个setrange事件。
- INCR, DECR, INCRBY, DECRBY 都产生incrby事件。
- INCRBYFLOAT 产生一个incrbyfloat事件。
- APPEND 产生一个append事件。
- LPUSH和LPUSHX 产生单个lpush事件，即使在可变情况下(even in the variadic case)。
- RPUSH和RPUSHX 产生单个rpush事件，即使在可变情况下(even in the variadic case)。
- RPOP 产生一个rpop事件。如果键由于最后一个元素被从列表中弹出而导致删除，会又产生一个del事件。
- LPOP 产生一个lpop事件。如果键由于最后一个元素被从列表中弹出而导致删除，会又产生一个del事件。
- LINSERT 产生一个linsert事件。
- LSET 产生一个lset事件。
- LREM 产生一个lrem事件。如果结果列表为空并且键被删除，会又产生一个del事件。
- LTRIM 产生一个ltrim事件。如果结果列表为空并且键被删除，会又产生一个del事件。
- RPOPLPUSH和BRPOPLPUSH 产生一个rpop事件和一个lpush事件。两种情况下顺序都能保证 (lpush事件总是在rpop事件之后被传递) 如果结果列表长度为零并且键被删除，会又产生一个del事件。
- HSET, HSETNX和HMSET 都产生单个hset事件。
- HINCRBY 产生一个hincrby事件。
- HINCRBYFLOAT 产生一个hincrbyfloat事件。
- HDEL 产生单个hdel事件。如果结果哈希为空并且键被删除，会又产生一个del事件。
- SADD 产生单个sadd事件，即使在可变情况下(even in the variadic case)。
- SREM 产生单个srem事件。如果结果集合为空并且键被删除，会又产生一个del事件。
- SMOVE 为源键产生一个srem事件为目标键产生一个sadd事件。
- SPOP 产生一个spop事件。如果结果集合为空并且键被删除，会又产生一个del事件。
- SINTERSTORE, SUNIONSTORE, SDIFFSTORE 分别产生sinterstore，sunionostore，sdiffstore事件。在特殊情况下，集合为空，且存储结果的键已经存在，由于键被删除，会产生一个del事件。
- ZINCR 产生一个zincr事件。
- ZADD产生单个zadd事件，即使添加了多个元素。.
- ZREM 产生单个zrem事件，即使删除了多个元素。当结果有序集合为空，并且键被生成时，会产生一个额外的del事件。
- ZREMBYSCORE 产生单个zrembyscore事件。当结果有序集合为空，并且键被生成时，会产生一个额外的del事件。
- ZREMBYRANK 产生单个zrembyrank事件。当结果有序集合为空，并且键被生成时，会产生一个额外的del事件。
- ZINTERSTORE和ZUNIONSTORE 分别产生zinterstore和zunionstore事件。在特殊情况下，集合为空，且存储结果的键已经存在，由于键被删除，会产生一个del事件。
- 每当一个关联有生存事件的键由于过期而被从数据集中删除时会产生一个expired事件。
- 每当一个键由于maxmemory策略而从数据集中被淘汰以节省内存时会产生一个evicted事件。